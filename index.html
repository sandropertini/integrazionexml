<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Smontaggio 3D con Procedura</title>
    <style>
        body { 
            margin: 0; 
            display: flex; 
            font-family: Arial, sans-serif; 
        }
        #viewer { 
            width: 70%; 
            height: 100vh; 
            border: none; 
        }
        #procedure { 
            width: 30%; 
            height: 100vh; 
            padding: 20px; 
            overflow-y: auto; 
            background: #fff; 
            border-left: 2px solid #ccc; 
        }
        #procedure h2 { 
            font-size: 1.5em; 
            margin-bottom: 10px; 
        }
        #procedure ol { 
            padding-left: 20px; 
        }
        #procedure li { 
            margin: 10px 0; 
        }
        #error { 
            color: red; 
        }
    </style>
</head>
<body>
    <!-- Iframe per richiamare index.html -->
    <iframe id="viewer" src="index.html"></iframe>

    <!-- Sezione per la procedura testuale -->
    <div id="procedure">
        <h2>Procedura di Smontaggio</h2>
        <ol id="steps"></ol>
        <div id="error"></div>
    </div>

    <!-- Script per caricare e parsare DEMO.xml -->
    <script>
        // Funzione per caricare e mostrare i passaggi
        function loadProcedure() {
            fetch('DEMO.xml')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('File XML non trovato o errore di caricamento: ' + response.status);
                    }
                    return response.text();
                })
                .then(data => {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(data, 'text/xml');
                    
                    // Verifica errori di parsing XML
                    if (xmlDoc.documentElement.nodeName === 'parsererror') {
                        throw new Error('Errore nel parsing del file XML');
                    }

                    // Estrazione dei proceduralStep annidati
                    const steps = xmlDoc.querySelectorAll('mainProcedure proceduralStep');
                    const stepList = document.getElementById('steps');
                    
                    if (steps.length === 0) {
                        document.getElementById('error').textContent = 'Nessun passaggio trovato nel file XML';
                        return;
                    }

                    steps.forEach((step, index) => {
                        const para = step.getElementsByTagName('para')[0];
                        const stepText = para ? para.textContent : 'Passaggio non disponibile';
                        const li = document.createElement('li');
                        li.textContent = `${index + 1}. ${stepText}`;
                        stepList.appendChild(li);
                    });
                })
                .catch(error => {
                    document.getElementById('error').textContent = 'Errore: ' + error.message;
                    console.error(error);
                });
        }

        // Esegui al caricamento della pagina
        window.onload = loadProcedure;
    </script>
</body>
</html>
