<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Smontaggio 3D con Procedura</title>
    <style>
        body { 
            margin: 0; 
            display: flex; 
            font-family: Arial, sans-serif; 
        }
        #viewer { 
            width: 70%; 
            height: 100vh; 
            border: none; 
        }
        #procedure { 
            width: 30%; 
            height: 100vh; 
            padding: 20px; 
            overflow-y: auto; 
            background: #fff; 
            border-left: 2px solid #ccc; 
        }
        #procedure h2 { 
            font-size: 1.5em; 
            margin-bottom: 10px; 
        }
        #procedure p#description { 
            font-style: italic; 
            margin-bottom: 15px; 
        }
        #procedure ol { 
            padding-left: 20px; 
        }
        #procedure li { 
            margin: 10px 0; 
        }
        #error { 
            color: red; 
        }
    </style>
</head>
<body>
    <!-- Iframe per richiamare 3D.html -->
    <iframe id="viewer" src="3D.html"></iframe>

    <!-- Sezione per la procedura testuale -->
    <div id="procedure">
        <h2 id="techname">Procedura di Smontaggio</h2>
        <p id="description"></p>
        <ol id="steps"></ol>
        <p id="error"></p>
    </div>

    <!-- Script per caricare e parsare DEMO.xml -->
    <script>
        fetch('DEMO.xml')
            .then(response => {
                if (!response.ok) {
                    throw new Error('File XML non trovato o non accessibile');
                }
                return response.text();
            })
            .then(data => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data, 'text/xml');
                
                // Estrazione di techname e infoname
                const techname = xmlDoc.getElementsByTagName('techname')[0]?.textContent || 'Nome procedura non disponibile';
                const infoname = xmlDoc.getElementsByTagName('infoname')[0]?.textContent || 'Descrizione non disponibile';
                document.getElementById('techname').textContent = techname;
                document.getElementById('description').textContent = infoname;

                // Estrazione dei passaggi procedurali da <mainfunc>
                const mainFunc = xmlDoc.getElementsByTagName('mainfunc')[0];
                if (!mainFunc) {
                    document.getElementById('error').textContent = 'Struttura XML non valida: mainfunc non trovato';
                    return;
                }
                const steps = mainFunc.getElementsByTagName('step1');
                const stepList = document.getElementById('steps');
                
                if (steps.length === 0) {
                    document.getElementById('error').textContent = 'Nessun passaggio trovato nel file XML';
                    return;
                }

                for (let i = 0; i < steps.length; i++) {
                    const para = steps[i].getElementsByTagName('para')[0];
                    const stepText = para ? para.textContent : 'Passaggio non disponibile';
                    const li = document.createElement('li');
                    li.textContent = `${i + 1}. ${stepText}`;
                    stepList.appendChild(li);
                }
            })
            .catch(error => {
                console.error('Errore:', error);
                document.getElementById('error').textContent = `Errore nel caricamento del file XML: ${error.message}`;
            });
    </script>
</body>
</html>
